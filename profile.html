<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ParkSpace - Profile</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: linear-gradient(to top, #000000 0%, #0f1419 25%, #1a2f1a 50%, #2d5a2d 75%, #4a8f4a 100%);
            min-height: 100vh;
            color: #333;
        }

        /* Header */
        .header {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            padding: 1rem 2rem;
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .nav {
            display: flex;
            justify-content: space-between;
            align-items: center;
            max-width: 1400px;
            margin: 0 auto;
            gap: 2rem;
        }

        .logo {
            font-size: 1.5rem;
            font-weight: 700;
            color: white;
            letter-spacing: -0.5px;
            flex-shrink: 0;
        }

        /* Main Search Bar */
        .main-search-bar {
            flex: 1;
            max-width: 600px;
            display: flex;
            align-items: center;
            background: rgba(255, 255, 255, 0.15);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 25px;
            padding: 0.5rem;
            transition: border-color 0.2s ease, box-shadow 0.2s ease;
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
        }

        .main-search-bar:focus-within {
            border-color: #34C759;
            box-shadow: 0 0 0 3px rgba(52, 199, 89, 0.2);
        }

        .main-search-icon {
            padding: 0 1rem;
            color: rgba(255, 255, 255, 0.7);
            font-size: 1.1rem;
        }

        .main-search-input {
            flex: 1;
            border: none;
            outline: none;
            padding: 0.875rem 0.5rem;
            font-size: 1rem;
            background: transparent;
            color: white;
        }

        .main-search-input::placeholder {
            color: rgba(255, 255, 255, 0.6);
        }

        /* Header Icons */
        .header-icons {
            display: flex;
            align-items: center;
            gap: 1rem;
            flex-shrink: 0;
        }

        .header-icon {
            width: 44px;
            height: 44px;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: rgba(255, 255, 255, 0.9);
            font-size: 1.2rem;
            cursor: pointer;
            transition: all 0.2s ease;
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
        }

        .header-icon:hover {
            background: rgba(255, 255, 255, 0.2);
            color: white;
            transform: translateY(-1px);
        }

        .header-icon.active {
            background: rgba(52, 199, 89, 0.3);
            border-color: #34C759;
        }

        /* Main Container */
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 2rem;
            display: grid;
            grid-template-columns: 1fr 320px;
            gap: 2rem;
            min-height: calc(100vh - 120px);
        }

        /* Profile Main Content */
        .profile-main {
            display: flex;
            flex-direction: column;
            gap: 2rem;
        }

        /* Profile Header Card */
        .profile-header-card {
            background: rgba(255, 255, 255, 0.08);
            backdrop-filter: blur(25px);
            -webkit-backdrop-filter: blur(25px);
            border-radius: 20px;
            padding: 2rem;
            border: 1px solid rgba(255, 255, 255, 0.12);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.4);
        }

        .profile-header {
            display: flex;
            align-items: center;
            gap: 2rem;
            margin-bottom: 2rem;
        }

        .profile-avatar {
            width: 120px;
            height: 120px;
            background: rgba(52, 199, 89, 0.3);
            border: 3px solid #34C759;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 3rem;
            color: white;
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
        }

        .profile-info h1 {
            color: white;
            font-size: 2rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
        }

        .profile-info .username {
            color: rgba(255, 255, 255, 0.7);
            font-size: 1.1rem;
            margin-bottom: 1rem;
        }

        .profile-stats {
            display: flex;
            gap: 2rem;
        }

        .stat-item {
            text-align: center;
        }

        .stat-number {
            color: #34C759;
            font-size: 1.5rem;
            font-weight: 700;
        }

        .stat-label {
            color: rgba(255, 255, 255, 0.7);
            font-size: 0.9rem;
        }

        .profile-actions {
            display: flex;
            gap: 1rem;
            margin-top: 1rem;
        }

        .btn {
            padding: 0.875rem 1.5rem;
            border: none;
            border-radius: 12px;
            font-weight: 600;
            font-size: 0.9rem;
            cursor: pointer;
            transition: all 0.2s ease;
            text-decoration: none;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
        }

        .btn-primary {
            background: #34C759;
            color: white;
        }

        .btn-primary:hover {
            background: #28a745;
            transform: translateY(-1px);
        }

        .btn-secondary {
            background: rgba(255, 255, 255, 0.1);
            color: white;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .btn-secondary:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        /* Content Sections */
        .content-section {
            background: rgba(255, 255, 255, 0.08);
            backdrop-filter: blur(25px);
            -webkit-backdrop-filter: blur(25px);
            border-radius: 20px;
            padding: 2rem;
            border: 1px solid rgba(255, 255, 255, 0.12);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.4);
        }

        .section-title {
            color: white;
            font-size: 1.25rem;
            font-weight: 700;
            margin-bottom: 1.5rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .parking-spots-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 1.5rem;
        }

        .parking-spot-card {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 16px;
            padding: 1.5rem;
            border: 1px solid rgba(255, 255, 255, 0.1);
            transition: all 0.2s ease;
        }

        .parking-spot-card:hover {
            background: rgba(255, 255, 255, 0.1);
            transform: translateY(-2px);
        }

        .spot-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }

        .spot-type {
            background: rgba(52, 199, 89, 0.2);
            color: #34C759;
            padding: 0.25rem 0.75rem;
            border-radius: 8px;
            font-size: 0.8rem;
            font-weight: 600;
        }

        .spot-status {
            padding: 0.25rem 0.75rem;
            border-radius: 8px;
            font-size: 0.8rem;
            font-weight: 600;
        }

        .spot-status.active {
            background: rgba(52, 199, 89, 0.2);
            color: #34C759;
        }

        .spot-status.inactive {
            background: rgba(255, 159, 10, 0.2);
            color: #FF9F0A;
        }

        .spot-image {
            width: 100%;
            height: 120px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            justify-content: center;
            color: rgba(255, 255, 255, 0.5);
            font-size: 2rem;
        }

        .spot-info {
            color: rgba(255, 255, 255, 0.8);
            font-size: 0.9rem;
            margin-bottom: 1rem;
        }

        .spot-price {
            color: white;
            font-size: 1.25rem;
            font-weight: 700;
        }

        /* Activity Feed */
        .activity-item {
            display: flex;
            align-items: start;
            gap: 1rem;
            padding: 1rem 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .activity-item:last-child {
            border-bottom: none;
        }

        .activity-icon {
            width: 40px;
            height: 40px;
            background: rgba(52, 199, 89, 0.2);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #34C759;
            font-size: 1rem;
            flex-shrink: 0;
        }

        .activity-content {
            flex: 1;
        }

        .activity-text {
            color: white;
            margin-bottom: 0.25rem;
        }

        .activity-time {
            color: rgba(255, 255, 255, 0.6);
            font-size: 0.85rem;
        }

        /* Right Sidebar */
        .sidebar {
            display: flex;
            flex-direction: column;
            gap: 1.5rem;
        }

        .sidebar-card {
            background: rgba(255, 255, 255, 0.08);
            backdrop-filter: blur(25px);
            -webkit-backdrop-filter: blur(25px);
            border-radius: 16px;
            padding: 1.5rem;
            border: 1px solid rgba(255, 255, 255, 0.12);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.4);
        }

        .sidebar-title {
            color: white;
            font-size: 1.1rem;
            font-weight: 700;
            margin-bottom: 1rem;
        }

        .booking-item {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
            padding: 1rem 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .booking-item:last-child {
            border-bottom: none;
        }

        .booking-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .booking-title {
            color: white;
            font-size: 0.9rem;
            font-weight: 600;
            margin: 0;
        }

        .booking-status {
            padding: 0.25rem 0.5rem;
            border-radius: 8px;
            font-size: 0.7rem;
            font-weight: 600;
            text-transform: capitalize;
        }

        .booking-status.confirmed {
            background: rgba(52, 199, 89, 0.2);
            color: #34C759;
        }

        .booking-status.pending {
            background: rgba(255, 159, 10, 0.2);
            color: #FF9F0A;
        }

        .booking-status.completed {
            background: rgba(52, 199, 89, 0.3);
            color: #28a745;
        }

        .booking-status.cancelled {
            background: rgba(255, 69, 58, 0.2);
            color: #FF453A;
        }

        .booking-details {
            color: rgba(255, 255, 255, 0.7);
            font-size: 0.8rem;
            line-height: 1.4;
        }

        .booking-cost {
            color: #34C759;
            font-weight: 600;
            font-size: 0.9rem;
        }

        .no-bookings {
            text-align: center;
            color: rgba(255, 255, 255, 0.6);
            padding: 2rem;
            font-style: italic;
        }

        /* Edit Profile Modal */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }

        .modal-content {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(25px);
            -webkit-backdrop-filter: blur(25px);
            border-radius: 20px;
            padding: 2rem;
            border: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.4);
            width: 90%;
            max-width: 500px;
            max-height: 90vh;
            overflow-y: auto;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
        }

        .modal-header h2 {
            color: white;
            font-size: 1.5rem;
            font-weight: 700;
            margin: 0;
        }

        .close-modal {
            background: none;
            border: none;
            color: rgba(255, 255, 255, 0.7);
            font-size: 2rem;
            cursor: pointer;
            padding: 0;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            transition: all 0.2s ease;
        }

        .close-modal:hover {
            background: rgba(255, 255, 255, 0.1);
            color: white;
        }

        .profile-picture-section {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 1rem;
            margin-bottom: 2rem;
            padding: 1.5rem;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 16px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .current-profile-pic {
            width: 100px;
            height: 100px;
            border-radius: 50%;
            overflow: hidden;
            position: relative;
            background: rgba(52, 199, 89, 0.3);
            border: 3px solid #34C759;
        }

        .current-profile-pic img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .avatar-placeholder {
            width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2.5rem;
            color: white;
        }

        .profile-pic-controls {
            display: flex;
            gap: 1rem;
            flex-wrap: wrap;
            justify-content: center;
        }

        .edit-profile-form {
            display: flex;
            flex-direction: column;
            gap: 1.5rem;
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
        }

        .form-group {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }

        .form-group label {
            color: white;
            font-weight: 600;
            font-size: 0.9rem;
        }

        .form-group input,
        .form-group textarea {
            padding: 0.875rem;
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 12px;
            background: rgba(255, 255, 255, 0.1);
            color: white;
            font-size: 1rem;
            transition: all 0.2s ease;
        }

        .form-group input:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: #34C759;
            box-shadow: 0 0 0 3px rgba(52, 199, 89, 0.2);
        }

        .form-group input::placeholder,
        .form-group textarea::placeholder {
            color: rgba(255, 255, 255, 0.5);
        }

        .form-actions {
            display: flex;
            gap: 1rem;
            justify-content: flex-end;
            margin-top: 1rem;
            padding-top: 1rem;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
        }

        .btn-danger {
            background: rgba(255, 69, 58, 0.8);
            color: white;
            border: 1px solid rgba(255, 69, 58, 0.3);
        }

        .btn-danger:hover {
            background: rgba(255, 69, 58, 1);
            transform: translateY(-1px);
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .nav {
                flex-direction: column;
                gap: 1rem;
            }

            .main-search-bar {
                max-width: 100%;
            }

            .container {
                grid-template-columns: 1fr;
                padding: 1rem;
            }

            .profile-header {
                flex-direction: column;
                text-align: center;
            }

            .profile-stats {
                justify-content: center;
            }

            .parking-spots-grid {
                grid-template-columns: 1fr;
            }

            .modal-content {
                width: 95%;
                padding: 1.5rem;
            }

            .form-row {
                grid-template-columns: 1fr;
            }

            .form-actions {
                flex-direction: column;
            }

            .profile-pic-controls {
                flex-direction: column;
                align-items: center;
            }
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header class="header">
        <nav class="nav">
            <div class="logo">ParkSpace</div>
            
            <!-- Main Search Bar -->
            <div class="main-search-bar">
                <div class="main-search-icon">üîç</div>
                <input type="text" class="main-search-input" placeholder="Search for parking spots, locations, or addresses...">
            </div>

            <!-- Header Icons -->
            <div class="header-icons">
                <div class="header-icon" title="Messages">üí¨</div>
                <div class="header-icon active" title="Profile">üë§</div>
            </div>
        </nav>
    </header>

    <!-- Main Container -->
    <div class="container">
        <!-- Profile Main Content -->
        <main class="profile-main">
            <!-- Profile Header -->
            <div class="profile-header-card">
                <div class="profile-header">
                    <div class="profile-avatar">üë§</div>
                    <div class="profile-info">
                        <h1>John Anderson</h1>
                        <div class="username">@john_anderson</div>
                        <div class="profile-stats">
                            <div class="stat-item">
                                <div class="stat-number">47</div>
                                <div class="stat-label">Bookings</div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-number">5</div>
                                <div class="stat-label">Spots Listed</div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-number">4.9</div>
                                <div class="stat-label">Rating</div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-number">$1,250</div>
                                <div class="stat-label">Earned</div>
                            </div>
                        </div>
                        <div class="profile-actions">
                            <button class="btn btn-primary">‚úèÔ∏è Edit Profile</button>
                            <button class="btn btn-secondary">‚öôÔ∏è Settings</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- My Parking Spots -->
            <div class="content-section">
                <h2 class="section-title">üöó My Parking Spots</h2>
                <div class="parking-spots-grid">
                    <div class="parking-spot-card">
                        <div class="spot-header">
                            <div class="spot-type">Driveway</div>
                            <div class="spot-status active">Active</div>
                        </div>
                        <div class="spot-image">üè†</div>
                        <div class="spot-info">
                            <div>üìç 123 Main Street, Downtown</div>
                            <div>‚≠ê 4.8 rating (32 reviews)</div>
                        </div>
                        <div class="spot-price">$12/hour</div>
                    </div>

                    <div class="parking-spot-card">
                        <div class="spot-header">
                            <div class="spot-type">Garage</div>
                            <div class="spot-status active">Active</div>
                        </div>
                        <div class="spot-image">üè¢</div>
                        <div class="spot-info">
                            <div>üìç 456 Oak Avenue, Midtown</div>
                            <div>‚≠ê 4.9 rating (18 reviews)</div>
                        </div>
                        <div class="spot-price">$18/hour</div>
                    </div>

                    <div class="parking-spot-card">
                        <div class="spot-header">
                            <div class="spot-type">Street</div>
                            <div class="spot-status inactive">Paused</div>
                        </div>
                        <div class="spot-image">üõ£Ô∏è</div>
                        <div class="spot-info">
                            <div>üìç 789 Pine Street, Uptown</div>
                            <div>‚≠ê 4.6 rating (12 reviews)</div>
                        </div>
                        <div class="spot-price">$8/hour</div>
                    </div>
                </div>
            </div>

            <!-- Recent Activity -->
            <div class="content-section">
                <h2 class="section-title">üìä Recent Activity</h2>
                <div class="activity-item">
                    <div class="activity-icon">üí∞</div>
                    <div class="activity-content">
                        <div class="activity-text">Received payment of $36 from Sarah M.</div>
                        <div class="activity-time">2 hours ago</div>
                    </div>
                </div>
                <div class="activity-item">
                    <div class="activity-icon">‚≠ê</div>
                    <div class="activity-content">
                        <div class="activity-text">Received 5-star review from Mike D.</div>
                        <div class="activity-time">5 hours ago</div>
                    </div>
                </div>
                <div class="activity-item">
                    <div class="activity-icon">üìÖ</div>
                    <div class="activity-content">
                        <div class="activity-text">New booking confirmed for tomorrow 2 PM</div>
                        <div class="activity-time">1 day ago</div>
                    </div>
                </div>
                <div class="activity-item">
                    <div class="activity-icon">üîß</div>
                    <div class="activity-content">
                        <div class="activity-text">Updated pricing for Main Street driveway</div>
                        <div class="activity-time">2 days ago</div>
                    </div>
                </div>
            </div>
        </main>

        <!-- Right Sidebar -->
        <aside class="sidebar">
            <!-- Quick Actions -->
            <div class="sidebar-card">
                <h3 class="sidebar-title">Quick Actions</h3>
                <button class="btn btn-primary" style="width: 100%; margin-bottom: 0.75rem;">‚ûï Add New Spot</button>
                <button class="btn btn-secondary" style="width: 100%; margin-bottom: 0.75rem;">üìä View Analytics</button>
                <button class="btn btn-secondary" style="width: 100%;">üí∞ Payout Settings</button>
            </div>

            <!-- My Bookings -->
            <div class="sidebar-card">
                <h3 class="sidebar-title">üìÖ My Recent Bookings</h3>
                <div id="bookings-list">
                    <!-- Bookings will be loaded dynamically -->
                    <div class="loading-message" style="text-align: center; color: rgba(255, 255, 255, 0.6); padding: 2rem;">
                        Loading bookings...
                    </div>
                </div>
            </div>

            <!-- Monthly Summary -->
            <div class="sidebar-card">
                <h3 class="sidebar-title">üìà This Month</h3>
                <div style="display: flex; flex-direction: column; gap: 1rem;">
                    <div style="display: flex; justify-content: space-between; align-items: center;">
                        <span style="color: rgba(255, 255, 255, 0.8);">Total Bookings</span>
                        <span style="color: white; font-weight: 600;">12</span>
                    </div>
                    <div style="display: flex; justify-content: space-between; align-items: center;">
                        <span style="color: rgba(255, 255, 255, 0.8);">Revenue</span>
                        <span style="color: #34C759; font-weight: 600;">$340</span>
                    </div>
                    <div style="display: flex; justify-content: space-between; align-items: center;">
                        <span style="color: rgba(255, 255, 255, 0.8);">Avg Rating</span>
                        <span style="color: white; font-weight: 600;">4.9 ‚≠ê</span>
                    </div>
                    <div style="display: flex; justify-content: space-between; align-items: center;">
                        <span style="color: rgba(255, 255, 255, 0.8);">Response Time</span>
                        <span style="color: white; font-weight: 600;">< 5 min</span>
                    </div>
                </div>
            </div>
        </aside>
    </div>

    <!-- Edit Profile Modal -->
    <div class="modal-overlay" id="edit-profile-modal" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h2>‚úèÔ∏è Edit Profile</h2>
                <button class="close-modal" id="close-edit-modal">√ó</button>
            </div>
            <form id="edit-profile-form" class="edit-profile-form">
                <div class="profile-picture-section">
                    <div class="current-profile-pic">
                        <img id="current-avatar" src="" alt="Profile Picture" style="display: none;">
                        <div id="avatar-placeholder" class="avatar-placeholder">üë§</div>
                    </div>
                    <div class="profile-pic-controls">
                        <input type="file" id="avatar-upload" accept="image/*" style="display: none;">
                        <button type="button" id="upload-avatar-btn" class="btn btn-secondary">üì∑ Upload Photo</button>
                        <button type="button" id="remove-avatar-btn" class="btn btn-danger" style="display: none;">üóëÔ∏è Remove Photo</button>
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="edit-first-name">First Name</label>
                        <input type="text" id="edit-first-name" name="first_name" placeholder="Enter first name">
                    </div>
                    <div class="form-group">
                        <label for="edit-last-name">Last Name</label>
                        <input type="text" id="edit-last-name" name="last_name" placeholder="Enter last name">
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="edit-username">Username</label>
                    <input type="text" id="edit-username" name="username" placeholder="Enter username" required>
                </div>
                
                <div class="form-group">
                    <label for="edit-email">Email</label>
                    <input type="email" id="edit-email" name="email" placeholder="Enter email" required>
                </div>
                
                <div class="form-group">
                    <label for="edit-phone">Phone Number</label>
                    <input type="tel" id="edit-phone" name="phone_number" placeholder="Enter phone number">
                </div>
                
                <div class="form-group">
                    <label for="edit-address">Address</label>
                    <textarea id="edit-address" name="address" placeholder="Enter address" rows="3"></textarea>
                </div>
                
                <div class="form-actions">
                    <button type="button" class="btn btn-secondary" id="cancel-edit">Cancel</button>
                    <button type="submit" class="btn btn-primary" id="save-profile">üíæ Save Changes</button>
                </div>
            </form>
        </div>
    </div>

    <script>
        // Profile functionality
        document.addEventListener('DOMContentLoaded', function() {
            // Check if user is logged in
            const user = JSON.parse(localStorage.getItem('user') || 'null');
            
            if (!user) {
                // Redirect to login if not logged in
                window.location.href = 'index.html';
                return;
            }

            // Load profile data
            loadProfileData(user.id);
            loadUserBookings(user.id);
            loadUserProperties(user.id);
        });

        // Load profile data from API
        async function loadProfileData(userId) {
            try {
                const response = await fetch(`http://127.0.0.1:3000/api/profile/${userId}`);
                
                if (!response.ok) {
                    throw new Error('Failed to load profile data');
                }

                const profile = await response.json();
                updateProfileUI(profile);
            } catch (error) {
                console.error('Error loading profile:', error);
                showErrorMessage('Failed to load profile data');
            }
        }

        // Update profile UI with data
        function updateProfileUI(profile) {
            // Store profile data globally for edit modal
            currentProfile = profile;
            
            // Update profile header
            const nameElement = document.querySelector('.profile-info h1');
            const usernameElement = document.querySelector('.username');
            
            if (nameElement) {
                const fullName = `${profile.first_name || ''} ${profile.last_name || ''}`.trim();
                nameElement.textContent = fullName || profile.username || 'User';
            }
            
            if (usernameElement) {
                usernameElement.textContent = `@${profile.username}`;
            }

            // Update profile avatar
            const profileAvatar = document.querySelector('.profile-avatar');
            if (profile.avatar_url) {
                profileAvatar.innerHTML = `<img src="${profile.avatar_url}" alt="Profile" style="width: 100%; height: 100%; object-fit: cover; border-radius: 50%;">`;
            } else {
                profileAvatar.innerHTML = 'üë§';
            }

            // Update profile stats
            const statElements = document.querySelectorAll('.stat-number');
            if (statElements.length >= 4) {
                statElements[0].textContent = profile.stats.bookings;
                statElements[1].textContent = profile.stats.properties;
                statElements[2].textContent = profile.stats.rating.toFixed(1);
                statElements[3].textContent = '$0'; // Earnings - would need separate API
            }

            // Update monthly summary
            const monthlyElements = document.querySelectorAll('.sidebar-card:last-child span');
            if (monthlyElements.length >= 8) {
                monthlyElements[1].textContent = profile.stats.bookings; // Total bookings
                monthlyElements[3].textContent = '$0'; // Revenue - would need separate calculation
                monthlyElements[5].textContent = `${profile.stats.rating.toFixed(1)} ‚≠ê`; // Avg rating
                monthlyElements[7].textContent = '< 5 min'; // Response time - placeholder
            }
        }

        // Load user bookings
        async function loadUserBookings(userId) {
            try {
                const response = await fetch(`http://127.0.0.1:3000/api/profile/${userId}/bookings`);
                
                if (!response.ok) {
                    throw new Error('Failed to load bookings');
                }

                const bookings = await response.json();
                displayBookings(bookings);
            } catch (error) {
                console.error('Error loading bookings:', error);
                displayBookingsError();
            }
        }

        // Display bookings in the sidebar
        function displayBookings(bookings) {
            const bookingsList = document.getElementById('bookings-list');
            
            if (!bookings || bookings.length === 0) {
                bookingsList.innerHTML = `
                    <div class="no-bookings">
                        No bookings yet. Book your first parking spot!
                    </div>
                `;
                return;
            }

            // Show only the most recent 5 bookings
            const recentBookings = bookings.slice(0, 5);
            
            bookingsList.innerHTML = recentBookings.map(booking => `
                <div class="booking-item">
                    <div class="booking-header">
                        <h4 class="booking-title">${booking.title}</h4>
                        <span class="booking-status ${booking.status}">${booking.status}</span>
                    </div>
                    <div class="booking-details">
                        üìç ${booking.address}<br>
                        üìÖ ${formatDateTime(booking.start_time)}<br>
                        üë§ Host: ${booking.owner_name}
                    </div>
                    <div class="booking-cost">$${booking.total_cost}</div>
                </div>
            `).join('');
        }

        // Display bookings error
        function displayBookingsError() {
            const bookingsList = document.getElementById('bookings-list');
            bookingsList.innerHTML = `
                <div class="no-bookings">
                    Failed to load bookings. Please try again.
                </div>
            `;
        }

        // Load user properties for the main section
        async function loadUserProperties(userId) {
            try {
                const response = await fetch(`http://127.0.0.1:3000/api/profile/${userId}/properties`);
                
                if (!response.ok) {
                    throw new Error('Failed to load properties');
                }

                const properties = await response.json();
                displayProperties(properties);
            } catch (error) {
                console.error('Error loading properties:', error);
                displayPropertiesError();
            }
        }

        // Display properties in the main section
        function displayProperties(properties) {
            const propertiesGrid = document.querySelector('.parking-spots-grid');
            
            if (!properties || properties.length === 0) {
                propertiesGrid.innerHTML = `
                    <div style="grid-column: 1 / -1; text-align: center; color: rgba(255, 255, 255, 0.6); padding: 3rem;">
                        <h3>No parking spots listed yet</h3>
                        <p>Add your first parking spot to start earning!</p>
                        <button class="btn btn-primary" style="margin-top: 1rem;">‚ûï Add Parking Spot</button>
                    </div>
                `;
                return;
            }

            propertiesGrid.innerHTML = properties.map(property => `
                <div class="parking-spot-card">
                    <div class="spot-header">
                        <div class="spot-type">${property.spot_type.replace('-', ' ').replace(/\b\w/g, l => l.toUpperCase())}</div>
                        <div class="spot-status ${property.status}">${property.status.charAt(0).toUpperCase() + property.status.slice(1)}</div>
                    </div>
                    <div class="spot-image">
                        ${property.photos && property.photos.length > 0 
                            ? `<img src="${property.photos[0]}" alt="${property.title}" style="width: 100%; height: 100%; object-fit: cover; border-radius: 12px;">` 
                            : getSpotTypeIcon(property.spot_type)
                        }
                    </div>
                    <div class="spot-info">
                        <div><strong>${property.title}</strong></div>
                        <div>üìç ${property.address}</div>
                        <div>‚≠ê 4.8 rating (0 reviews)</div>
                    </div>
                    <div class="spot-price">$${property.hourly_rate}/hour</div>
                </div>
            `).join('');
        }

        // Display properties error
        function displayPropertiesError() {
            const propertiesGrid = document.querySelector('.parking-spots-grid');
            propertiesGrid.innerHTML = `
                <div style="grid-column: 1 / -1; text-align: center; color: rgba(255, 255, 255, 0.6); padding: 3rem;">
                    <h3>Failed to load parking spots</h3>
                    <p>Please try refreshing the page.</p>
                </div>
            `;
        }

        // Get appropriate icon for spot type
        function getSpotTypeIcon(spotType) {
            const icons = {
                'driveway': 'üè†',
                'garage-private': 'üè¢',
                'garage-shared': 'üè¢',
                'carport': 'üèóÔ∏è',
                'street-private': 'üõ£Ô∏è',
                'outdoor-lot': 'üÖøÔ∏è'
            };
            return icons[spotType] || 'üöó';
        }

        // Format datetime for display
        function formatDateTime(dateTimeString) {
            const date = new Date(dateTimeString);
            const options = { 
                month: 'short', 
                day: 'numeric', 
                hour: 'numeric', 
                minute: '2-digit',
                hour12: true 
            };
            return date.toLocaleDateString('en-US', options);
        }

        // Show error message
        function showErrorMessage(message) {
            // You could implement a toast notification here
            console.error(message);
        }

        // Navigation functionality
        document.querySelector('.header-icon[title="Messages"]').addEventListener('click', function() {
            // Navigate to messages (you'd implement this)
            console.log('Navigate to messages');
        });

        // Global variable to store current profile data
        let currentProfile = null;

        // Edit profile button functionality
        document.querySelector('.btn-primary').addEventListener('click', function() {
            openEditProfileModal();
        });

        // Settings button functionality
        document.querySelector('.btn-secondary').addEventListener('click', function() {
            // You could open settings modal here
            console.log('Settings clicked');
            alert('Settings functionality would be implemented here');
        });

        // Search functionality
        document.querySelector('.main-search-input').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                const searchTerm = this.value.trim();
                if (searchTerm) {
                    // Navigate to search results
                    window.location.href = `search_result.html?location=${encodeURIComponent(searchTerm)}`;
                }
            }
        });

        // Edit Profile Modal Functions
        function openEditProfileModal() {
            if (!currentProfile) {
                alert('Profile data not loaded yet. Please wait a moment and try again.');
                return;
            }

            const modal = document.getElementById('edit-profile-modal');
            populateEditForm(currentProfile);
            modal.style.display = 'flex';
            document.body.style.overflow = 'hidden'; // Prevent background scrolling
        }

        function closeEditProfileModal() {
            const modal = document.getElementById('edit-profile-modal');
            modal.style.display = 'none';
            document.body.style.overflow = 'auto'; // Restore scrolling
            resetEditForm();
        }

        function populateEditForm(profile) {
            // Populate form fields with current data
            document.getElementById('edit-first-name').value = profile.first_name || '';
            document.getElementById('edit-last-name').value = profile.last_name || '';
            document.getElementById('edit-username').value = profile.username || '';
            document.getElementById('edit-email').value = profile.email || '';
            document.getElementById('edit-phone').value = profile.phone_number || '';
            document.getElementById('edit-address').value = profile.address || '';

            // Handle profile picture
            const currentAvatar = document.getElementById('current-avatar');
            const avatarPlaceholder = document.getElementById('avatar-placeholder');
            const removeBtn = document.getElementById('remove-avatar-btn');
            
            if (profile.avatar_url) {
                currentAvatar.src = profile.avatar_url;
                currentAvatar.style.display = 'block';
                avatarPlaceholder.style.display = 'none';
                removeBtn.style.display = 'inline-flex';
            } else {
                currentAvatar.style.display = 'none';
                avatarPlaceholder.style.display = 'flex';
                removeBtn.style.display = 'none';
            }
        }

        function resetEditForm() {
            document.getElementById('edit-profile-form').reset();
            document.getElementById('current-avatar').style.display = 'none';
            document.getElementById('avatar-placeholder').style.display = 'flex';
            document.getElementById('remove-avatar-btn').style.display = 'none';
        }

        // Modal event listeners
        document.getElementById('close-edit-modal').addEventListener('click', closeEditProfileModal);
        document.getElementById('cancel-edit').addEventListener('click', closeEditProfileModal);

        // Close modal when clicking outside
        document.getElementById('edit-profile-modal').addEventListener('click', function(e) {
            if (e.target === this) {
                closeEditProfileModal();
            }
        });

        // Avatar upload functionality
        document.getElementById('upload-avatar-btn').addEventListener('click', function() {
            document.getElementById('avatar-upload').click();
        });

        document.getElementById('avatar-upload').addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (file) {
                // Validate file type
                if (!file.type.startsWith('image/')) {
                    alert('Please select an image file.');
                    return;
                }

                // Validate file size (max 5MB)
                if (file.size > 5 * 1024 * 1024) {
                    alert('Image size must be less than 5MB.');
                    return;
                }

                // Preview the image
                const reader = new FileReader();
                reader.onload = function(e) {
                    const currentAvatar = document.getElementById('current-avatar');
                    const avatarPlaceholder = document.getElementById('avatar-placeholder');
                    const removeBtn = document.getElementById('remove-avatar-btn');
                    
                    currentAvatar.src = e.target.result;
                    currentAvatar.style.display = 'block';
                    avatarPlaceholder.style.display = 'none';
                    removeBtn.style.display = 'inline-flex';
                };
                reader.readAsDataURL(file);
            }
        });

        // Remove avatar functionality
        document.getElementById('remove-avatar-btn').addEventListener('click', function() {
            const currentAvatar = document.getElementById('current-avatar');
            const avatarPlaceholder = document.getElementById('avatar-placeholder');
            const removeBtn = document.getElementById('remove-avatar-btn');
            const avatarUpload = document.getElementById('avatar-upload');
            
            currentAvatar.src = '';
            currentAvatar.style.display = 'none';
            avatarPlaceholder.style.display = 'flex';
            removeBtn.style.display = 'none';
            avatarUpload.value = ''; // Clear file input
        });

        // Form submission
        document.getElementById('edit-profile-form').addEventListener('submit', async function(e) {
            e.preventDefault();
            await saveProfileChanges();
        });

        async function saveProfileChanges() {
            const user = JSON.parse(localStorage.getItem('user'));
            if (!user) {
                alert('User session expired. Please login again.');
                window.location.href = 'index.html';
                return;
            }

            const submitBtn = document.getElementById('save-profile');
            const originalText = submitBtn.textContent;
            
            try {
                // Disable submit button
                submitBtn.disabled = true;
                submitBtn.textContent = 'üíæ Saving...';

                // Prepare form data
                const formData = {
                    first_name: document.getElementById('edit-first-name').value.trim(),
                    last_name: document.getElementById('edit-last-name').value.trim(),
                    username: document.getElementById('edit-username').value.trim(),
                    email: document.getElementById('edit-email').value.trim(),
                    phone_number: document.getElementById('edit-phone').value.trim(),
                    address: document.getElementById('edit-address').value.trim()
                };

                // Handle avatar upload if new image is selected
                const avatarFile = document.getElementById('avatar-upload').files[0];
                if (avatarFile) {
                    // Upload avatar to S3 first
                    const avatarFormData = new FormData();
                    avatarFormData.append('image', avatarFile);

                    const uploadResponse = await fetch('http://127.0.0.1:3000/api/s3-test-upload', {
                        method: 'POST',
                        body: avatarFormData
                    });

                    if (uploadResponse.ok) {
                        const uploadData = await uploadResponse.json();
                        formData.avatar_url = uploadData.url;
                    } else {
                        throw new Error('Failed to upload avatar image');
                    }
                } else if (document.getElementById('current-avatar').style.display === 'none') {
                    // Avatar was removed
                    formData.avatar_url = null;
                }

                // Update profile
                const response = await fetch(`http://127.0.0.1:3000/api/profile/${user.id}`, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(formData)
                });

                if (!response.ok) {
                    throw new Error('Failed to update profile');
                }

                // Success - reload profile data and close modal
                submitBtn.textContent = '‚úÖ Saved!';
                await loadProfileData(user.id);
                
                setTimeout(() => {
                    closeEditProfileModal();
                    showSuccessMessage('Profile updated successfully!');
                }, 1000);

            } catch (error) {
                console.error('Error saving profile:', error);
                alert('Failed to save profile changes: ' + error.message);
            } finally {
                // Re-enable submit button
                setTimeout(() => {
                    submitBtn.disabled = false;
                    submitBtn.textContent = originalText;
                }, 2000);
            }
        }

        function showSuccessMessage(message) {
            // Create and show a temporary success message
            const successDiv = document.createElement('div');
            successDiv.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: rgba(52, 199, 89, 0.9);
                color: white;
                padding: 1rem 2rem;
                border-radius: 12px;
                font-weight: 600;
                z-index: 10000;
                box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
            `;
            successDiv.textContent = message;
            document.body.appendChild(successDiv);

            // Remove after 3 seconds
            setTimeout(() => {
                if (successDiv.parentNode) {
                    successDiv.parentNode.removeChild(successDiv);
                }
            }, 3000);
        }
    </script>
</body>
</html>
